## 数据库SQL
区域entity：Area
数据库建表语句  
```sql
create table tb_area(
    area_id int(2) not null auto_increment,
    area_name varchar(200) not null,
    priority int(2) not null default '0',
    create_time datetime default null,
    last_edit_time datetime default null,
    primary key(area_id),
    unique key UK_AREA(area_name)
) engine=InnoDB auto_increment=1 default charset=utf8;
```  
用户entity：PersonInfo  
数据库建表语句 
```sql
create table tb_person_info(
    user_id int(10) not null auto_increment,
    name varchar(32) default null,
    profile_img varchar(1024) default null,
    email varchar(1024) default null,
    gender varchar(2) default null,
    enable_status int(2) not null default '0' comment'0:禁止使用本商城，1:允许使用本商城',
    user_type int(2) not null default '1' comment'1:顾客，2:商家，3:超级管理员',
    create_time datetime default null,
    last_edit_time datetime default null,
    primary key(user_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
微信登录关联
```sql
create table tb_wechat_auth(
    wechat_auth_id int(10) not null auto_increment,
    user_id int(10) not null,
    open_id varchar(1024) not null,
    create_time datetime default null,
    primary key(wechat_auth_id),
    constraint fk_wechatauth_profile foreign key(user_id) references tb_person_info(user_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
本地登录
```sql
create table tb_local_auth(
    local_auth_id int(10) not null auto_increment,
    user_id int(10) not null,
    username varchar(128) not null,
    password varchar(128) not null,
    create_time datetime default null,
    last_edit_time datetime default null,
    primary key(local_auth_id),
    unique key(username),
    constraint fk_localauth_profile foreign key(user_id) references tb_person_info(user_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
头条
```sql
create table tb_head_line(
    line_id int(100) not null auto_increment,
    line_name varchar(1000) default null,
    line_link varchar(2000) not null,
    line_img varchar(2000) not null,
    priority int(2) default null,
    enable_status int(2) not null default '0',
    create_time datetime default null,
    last_edit_time datetime default null,
    primary key(line_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
店铺分类
```sql
create table tb_shop_category(
    shop_category_id int(11) not null auto_increment,
    shop_category_name varchar(100) not null default '',
    shop_category_desc varchar(1000) default '',
    shop_category_img varchar(2000) default null,
    priority int(2) not null default '0',
    create_time datetime default null,
    last_edit_time datetime default null,
    parent_id int(11) default null,
    primary key(shop_category_id),
    constraint fk_shop_category_self foreign key(parent_id) references tb_shop_category(shop_category_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
店铺表
```sql
create table tb_shop(
    shop_id int(10) not null auto_increment,
    owner_id int(10) not null comment '店铺创建人',
    area_id int(5) default null,
    shop_category_id int(11) default null,
    shop_name varchar(256) not null,
    shop_desc varchar(1024) default null,
    shop_addr varchar(200) default null,
    phone varchar(128) default null,
    shop_img varchar(1024) default null,
    priority int(3) default '0',
    create_time datetime default null,
    last_edit_time datetime default null,
    enable_status int(2) not null default '0',
    advice varchar(255) default null,
    primary key(shop_id),
    constraint fk_shop_area foreign key(area_id) references tb_area(area_id),
    constraint fk_shop_profile foreign key(owner_id) references tb_person_info(user_id),
    constraint fk_shop_shopcate foreign key(shop_category_id) references tb_shop_category(shop_category_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
商品分类
```sql
create table tb_product_category(
    product_category_id int(11) not null auto_increment,
    product_category_name varchar(100) not null,
    priority int(2) default '0',
    create_time datetime default null,
    shop_id int(20) not null default '0',
    primary key(product_category_id),
    constraint fk_procate_shop foreign key(shop_id) references tb_shop(shop_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
商品表
```sql
create table tb_product(
    product_id int(100) not null auto_increment,
    product_name varchar(100) not null,
    product_desc varchar(2000) default null,
    img_addr varchar(2000) default '',
    normal_price varchar(100) default null,
    promotion_price varchar(100) default null,
    priority int(2) not null default '0',
    create_time datetime default null,
    last_edit_time datetime default null,
    enable_status int(2) not null default '0',
    product_category_id int(11) default null,
    shop_id int(20) not null default '0',
    primary key(product_id),
    constraint fk_product_procate foreign key(product_category_id) references tb_product_category(product_category_id),
    constraint fk_product__shop foreign key(shop_id) references tb_shop(shop_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```
商品详情图片
```sql
create table tb_product_img(
    product_img_id int(20) not null auto_increment,
    img_addr varchar(2000) not null,
    img_desc varchar(2000) default null,
    priority int(2) default '0',
    create_time datetime default null,
    product_id int(20) default null,
    primary key(product_img_id),
    constraint fk_shop_proimg_product foreign key(product_id) references tb_product(product_id)
)engine=InnoDB auto_increment=1 default charset=utf8;
```

## logback日志组件的引入  
在pom.xml中引入logback所需jar
```xml
<!-- 添加日志相关jar包 logback+slf4j -->
<dependencies>
    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-api</artifactId>
        <version>${slf4j.version}</version>
    </dependency>
    <dependency>
        <groupId>ch.qos.logback</groupId>
        <artifactId>logback-core</artifactId>
        <version>${logback.version}</version>
    </dependency>
    <dependency>
        <groupId>ch.qos.logback</groupId>
        <artifactId>logback-classic</artifactId>
        <version>${logback.version}</version>
        <exclusions>
            <exclusion>
                <artifactId>slf4j-api</artifactId>
                <groupId>org.slf4j</groupId>
            </exclusion>
            <exclusion>
                <artifactId>slf4j-api</artifactId>
                <groupId>org.slf4j</groupId>
            </exclusion>
            <exclusion>
                <artifactId>slf4j-api</artifactId>
                <groupId>org.slf4j</groupId>
            </exclusion>
        </exclusions>
    </dependency>
</dependencies>
```
在src/resources下新建logback.xml,具体配置见文件
## 引入thumbnailator进行图片处理
pom.xml  
```xml
<!-- 图片处理-->
<dependency>
    <groupId>net.coobird</groupId>
    <artifactId>thumbnailator</artifactId>
    <version>0.4.8</version>
</dependency>
```
可以对图片进行压缩及打水印等功能
## 引入kaptcha实现验证码
pom.xml
```xml
<dependency>
    <groupId>com.github.penggle</groupId>
    <artifactId>kaptcha</artifactId>
    <version>2.3.2</version>
</dependency>
```
在web.xml下进行配置验证码必要设置
```xml
<web-app>
    <!-- 验证码-->
    <servlet>
        <servlet-name>Kaptcha</servlet-name>
        <servlet-class>com.google.code.kaptcha.servlet.KaptchaServlet</servlet-class>
        <!--是否有边框-->
        <init-param>
            <param-name>kaptcha.border</param-name>
            <param-value>no</param-value>
        </init-param>
        <!--字体颜色-->
        <init-param>
            <param-name>kaptcha.textproducer.font.color</param-name>
            <param-value>red</param-value>
        </init-param>
        <!--图片宽度-->
        <init-param>
            <param-name>kaptcha.image.width</param-name>
            <param-value>135</param-value>
        </init-param>
        <!--使用哪些字符生成验证码-->
        <init-param>
            <param-name>kaptcha.textproducer.char.string</param-name>
            <param-value>ACDEFHKPRSTWX345679</param-value>
        </init-param>
        <!--图片高度-->
        <init-param>
            <param-name>kaptcha.image.height</param-name>
            <param-value>50</param-value>
        </init-param>
        <!--字体大小-->
        <init-param>
            <param-name>kaptcha.textproducer.font.size</param-name>
            <param-value>43</param-value>
        </init-param>
        <!--干扰线的颜色-->
        <init-param>
            <param-name>kaptcha.noise.color</param-name>
            <param-value>black</param-value>
        </init-param>
        <!--验证码字符个数-->
        <init-param>
            <param-name>kaptcha.textproducer.char.length</param-name>
            <param-value>4</param-value>
        </init-param>
        <!--字体-->
        <init-param>
            <param-name>kaptcha.textproducer.font.names</param-name>
            <param-value>Arial</param-value>
        </init-param>
    </servlet>
    <servlet-mapping>
        <servlet-name>Kaptcha</servlet-name>
        <url-pattern>/Kaptcha</url-pattern>
    </servlet-mapping>
</web-app>
```

### 奖品表数据库建表
```sql
CREATE TABLE `tb_award` (
  `award_id` int(10) NOT NULL AUTO_INCREMENT,
  `award_name` varchar(256) COLLATE utf8_unicode_ci NOT NULL,
  `award_desc` varchar(1024) COLLATE utf8_unicode_ci DEFAULT NULL,
  `award_img` varchar(1024) COLLATE utf8_unicode_ci DEFAULT NULL,
  `point` int(10) NOT NULL DEFAULT '0',
  `priority` int(2) DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `expire_time` datetime DEFAULT NULL,
  `last_edit_time` datetime DEFAULT NULL,
  `enable_status` int(2) NOT NULL DEFAULT '0',
  `shop_id` int(10) DEFAULT NULL,
  PRIMARY KEY (`award_id`),
  KEY `fk_award_shop_idx` (`shop_id`),
  CONSTRAINT `fk_award_shop` FOREIGN KEY (`shop_id`) REFERENCES `tb_shop` (`shop_id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
```
### 顾客已领取的奖品表记录
```sql
CREATE TABLE `tb_user_award_map` (
  `user_award_id` int(10) NOT NULL AUTO_INCREMENT,
  `user_id` int(10) NOT NULL,
  `award_id` int(10) NOT NULL,
  `shop_id` int(10) NOT NULL,
  `user_name` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  `award_name` varchar(255) COLLATE utf8_unicode_ci DEFAULT NULL,
  `expire_time` datetime DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `used_status` int(2) NOT NULL DEFAULT '0',
  `point` int(10) DEFAULT NULL,
  PRIMARY KEY (`user_award_id`),
  KEY `fk_user_award_map_profile` (`user_id`),
  KEY `fk_user_award_map_award` (`award_id`),
  KEY `fk_user_award_map_shop` (`shop_id`),
  CONSTRAINT `fk_user_award_map_award` FOREIGN KEY (`award_id`) REFERENCES `tb_award` (`award_id`),
  CONSTRAINT `fk_user_award_map_profile` FOREIGN KEY (`user_id`) REFERENCES `tb_person_info` (`user_id`),
  CONSTRAINT `fk_user_award_map_shop` FOREIGN KEY (`shop_id`) REFERENCES `tb_shop` (`shop_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
```
##userProductMap
```sql
CREATE TABLE `tb_user_product_map` (
  `user_product_id` int(30) NOT NULL AUTO_INCREMENT,
  `user_id` int(10) DEFAULT NULL,
  `product_id` int(100) DEFAULT NULL,
  `shop_id` int(10) DEFAULT NULL,
  `user_name` varchar(255) DEFAULT NULL,
  `product_name` varchar(255) DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `point` int(10) DEFAULT '0',
  PRIMARY KEY (`user_product_id`),
  KEY `fk_user_product_map_profile` (`user_id`),
  KEY `fk_user_product_map_product` (`product_id`),
  KEY `fk_user_product_map_shop` (`shop_id`),
  CONSTRAINT `fk_user_product_map_product` FOREIGN KEY (`product_id`) REFERENCES `tb_product` (`product_id`),
  CONSTRAINT `fk_user_product_map_profile` FOREIGN KEY (`user_id`) REFERENCES `tb_person_info` (`user_id`),
  CONSTRAINT `fk_user_product_map_shop` FOREIGN KEY (`shop_id`) REFERENCES `tb_shop` (`shop_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```
## product_sell_daily
```sql
CREATE TABLE `tb_product_sell_daily` (
  `product_id` int(10) DEFAULT NULL,
  `shop_id` int(10) DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `total` int(10) DEFAULT '0',
  KEY `fk_product_sell_daily_product` (`product_id`),
  KEY `fk_product_sell_daily_shop` (`shop_id`),
  CONSTRAINT `fk_product_sell_daily_product` FOREIGN KEY (`product_id`) REFERENCES `tb_product` (`product_id`),
  CONSTRAINT `fk_product_sell_daily_shop` FOREIGN KEY (`shop_id`) REFERENCES `tb_shop` (`shop_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```
## user_shop_map
```sql
CREATE TABLE `tb_user_shop_map` (
  `user_shop_id` int(30) NOT NULL AUTO_INCREMENT,
  `user_id` int(10) NOT NULL,
  `shop_id` int(10) NOT NULL,
  `create_time` datetime DEFAULT NULL,
  `point` int(10) DEFAULT NULL,
  PRIMARY KEY (`user_shop_id`),
  UNIQUE KEY `uq_user_shop` (`user_id`,`shop_id`),
  KEY `fk_user_shop_shop` (`shop_id`),
  CONSTRAINT `fk_user_shop_shop` FOREIGN KEY (`shop_id`) REFERENCES `tb_shop` (`shop_id`),
  CONSTRAINT `fk_user_shop_user` FOREIGN KEY (`user_id`) REFERENCES `tb_person_info` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```